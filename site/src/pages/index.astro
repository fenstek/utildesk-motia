---
import BaseLayout from "../layouts/BaseLayout.astro";
import { readdir, readFile } from "node:fs/promises";
import { join } from "node:path";
import matter from "gray-matter";

// –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 6 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Å–µ–∫—Ü–∏–∏ "Latest Tools"
const toolsDir = join(process.cwd(), "content", "tools");

const toolImagesDir = join(process.cwd(), "public", "images", "tools");
let toolImageFiles = [];
try { toolImageFiles = await readdir(toolImagesDir); } catch {}
const toolImageBySlug = new Map(
  toolImageFiles.map(f => [f.replace(/\..+$/, ""), `/images/tools/${f}`])
);

const files = (await readdir(toolsDir))
  .filter((f) => f.endsWith(".md") && !f.startsWith("_"));

const tools = await Promise.all(
  files.map(async (file) => {
    const full = join(toolsDir, file);
    const raw = await readFile(full, "utf-8");
    const { data } = matter(raw);
    const slug = String(data.slug ?? file.replace(/\.md$/, ""));
    const title = String(data.title ?? slug);
    const category = data.category ? String(data.category) : null;
    const price_model = data.price_model ? String(data.price_model) : null;
    const image = data.image ? String(data.image) : (toolImageBySlug.get(slug) ?? null);
    return { slug, title, category, price_model, image };
  })
);

tools.sort((a, b) => a.title.localeCompare(b.title, "de"));
const latestTools = tools.slice(0, 6);
---

<BaseLayout
  title="Utildesk ‚Äî Tools & Guides f√ºr AI und Produktivit√§t"
  description="Kuratiertes Verzeichnis n√ºtzlicher AI- und Produktivit√§tstools. Warm minimal SaaS directory."
>
  <!-- Hero Section -->
  <section class="hero">
    <h1 class="hero-title">Utildesk</h1>
    <p class="hero-subtitle">
      Tools & Guides f√ºr AI, Automatisierung und Produktivit√§t.
      Kuratiertes Verzeichnis mit allem, was du f√ºr effizientes Arbeiten brauchst.
    </p>
    <a href="/tools/" class="hero-cta">
      Alle Tools entdecken ‚Üí
    </a>
  </section>

  <!-- Features Section -->
  <section class="section">
    <div class="section-header">
      <h2 class="section-title">Was dich erwartet</h2>
      <p class="section-subtitle">
        Sorgf√§ltig kuratierte Tools f√ºr moderne Teams und Einzelpersonen
      </p>
    </div>

    <div class="grid grid-3">
      <div class="card feature-card">
        <div class="feature-icon">ü§ñ</div>
        <h3 class="feature-title">AI-Tools</h3>
        <p class="feature-desc">
          Modernste KI-Technologie f√ºr Textgenerierung, Bildbearbeitung und intelligente Automatisierung.
        </p>
      </div>

      <div class="card feature-card">
        <div class="feature-icon">‚ö°</div>
        <h3 class="feature-title">Produktivit√§t</h3>
        <p class="feature-desc">
          Optimiere deinen Workflow mit erstklassigen Produktivit√§tstools und smarten Workflows.
        </p>
      </div>

      <div class="card feature-card">
        <div class="feature-icon">üéØ</div>
        <h3 class="feature-title">Kuratiert</h3>
        <p class="feature-desc">
          Jedes Tool wird sorgf√§ltig gepr√ºft und dokumentiert, damit du schnell das Richtige findest.
        </p>
      </div>
    </div>
  </section>

  <!-- Latest Tools Section -->
  <section class="section">
    <div class="section-header">
      <h2 class="section-title">Beliebte Tools</h2>
      <p class="section-subtitle">
        Eine Auswahl der meistgenutzten Tools aus unserem Verzeichnis
      </p>
    </div>

    <div class="home-tools-grid">
      {latestTools.map((tool) => (
        <a href={`/tools/${tool.slug}/`} class="card tool-card">
          <div class="tool-header">
            <div class="home-tool-image">
              {tool.image ? (
                <img src={tool.image} alt={tool.title} />
              ) : null}
            </div>
            <div class="home-tool-info">
              <h3 class="home-tool-title">{tool.title}</h3>
              <p class="home-tool-meta">{tool.slug}</p>
{tool.excerpt && <p class="home-tool-excerpt">{tool.excerpt}</p>}
            </div>
          </div>
          <div class="home-tool-badges">
            {tool.category && (
              <span class="badge badge-category">{tool.category}</span>
            )}
            {tool.price_model && (
              <span class="badge badge-price">{tool.price_model}</span>
            )}
          </div>
        </a>
      ))}
    </div>

    <div style="text-align: center; margin-top: 48px;">
      <a href="/tools/" class="hero-cta">
        Alle {tools.length} Tools durchsuchen ‚Üí
      </a>
    </div>
  </section>
</BaseLayout>
