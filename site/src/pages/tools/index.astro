---
import { readdir, readFile } from "node:fs/promises";
import { join } from "node:path";
import matter from "gray-matter";
import BaseLayout from "../../layouts/BaseLayout.astro";

const toolsDir = join(process.cwd(), "content", "tools");
const files = (await readdir(toolsDir))
  .filter((f) => f.endsWith(".md") && !f.startsWith("_"));

const tools = await Promise.all(
  files.map(async (file) => {
    const full = join(toolsDir, file);
    const raw = await readFile(full, "utf-8");
    const { data } = matter(raw);
    const slug = String(data.slug ?? file.replace(/\.md$/, ""));
    const title = String(data.title ?? slug);
    const image = data.image ? String(data.image) : "";
    return { slug, title, image };
  })
);

tools.sort((a, b) => a.title.localeCompare(b.title, "de"));
---

<BaseLayout title="Tools â€” utildesk" description="Tools directory">
  <div class="hero">
    <div class="heroBox">
      <h1>Tools</h1>
      <p class="muted">Tool-Katalog (MVP)</p>
    </div>
  </div>

  <div class="grid">
    {tools.map((t) => (
      <a class="card" href={`/tools/${t.slug}/`}>
        <div class="cardTop">
{
  (() => {
    const src = t.image?.trim() ? t.image : `/images/tools/${t.slug}.webp`;
    return <img class="thumb" src={src} alt={t.title} loading="lazy" />;
  })()
}
          <div>
            <p class="cardTitle">{t.title}</p>
            <p class="cardMeta">/tools/{t.slug}/</p>
          </div>
        </div>
      </a>
    ))}
  </div>
</BaseLayout>
